<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Room Booking</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <script src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <script>
        $(function() {
            $('input[name="daterange"]').daterangepicker({
                opens: 'left',
                minDate: '2024-05-01',
                maxDate: '2025-05-01',
                locale: {
                    format: 'YYYY-MM-DD'
                }
            });
        });
    </script>
</head>
<body>
<div class="container mt-5">
    <h2>Book Your Room</h2>
    <form id="searchForm" class="mb-3">
        <div class="row g-3 align-items-center">
            <div class="col-auto">
                <label for="daterange" class="col-form-label">Date Range:</label>
                <input type="text" id="daterange" name="daterange" class="form-control">
            </div>
            <div class="col-auto">
                <label for="number_of_guests" class="col-form-label">Number of Guests:</label>
                <select id="number_of_guests" name="number_of_guests" class="form-select">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary">Search Availability</button>
            </div>
        </div>
    </form>
    <div id="resultsTable">
       
    </div>
</div>

<script>
    // Handle form submission for searching availability
    $('#searchForm').on('submit', function(e) {
        e.preventDefault();
        var data = $(this).serialize();
        $.post('/customer/search', data, function(rooms) {
            var rows = '';
            rooms.forEach(function(room) {
                rows += `<tr>
                    <td>${room.room_type}</td>
                    <td>${room.room_description}</td>
                    <td>$NZD ${room.price}</td>
                    <td>${room.space}</td>
                    <td>${room.availability}</td>
                    <td><button class="btn btn-success reserveBtn" data-room-id="${room.room_id}" data-start-date="${$('#daterange').data('daterangepicker').startDate.format('YYYY-MM-DD')}" data-end-date="${$('#daterange').data('daterangepicker').endDate.format('YYYY-MM-DD')}" data-guests="${$('#number_of_guests').val()}">Reserve</button></td>
                </tr>`;
            });
            var table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Room Type</th>
                            <th>Room Info</th>
                            <th>Per Night</th>
                            <th>Space</th>
                            <th>Availability</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>${rows}</tbody>
                </table>`;
            $('#resultsTable').html(table);
        }, 'json');
    });

    // Handle reservation
    $(document).on('click', '.reserveBtn', function() {
        var button = $(this);
        var data = {
            room_id: button.data('room-id'),
            start_date: button.data('start-date'),
            end_date: button.data('end-date'),
            number_of_guests: button.data('guests')
        };
        $.post('/customer/book', data, function(response) {
            if (response.success) {
                alert('Reservation successful!');
            } else {
                alert('Failed to reserve: ' + response.error);
            }
        }, 'json');
    });
</script>
</body>
</html>
