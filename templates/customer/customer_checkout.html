{% extends 'base.html' %}

{% block title %}Customer Dashboard{% endblock %}

{% block content %}
<div class="content">
    <!-- insert customer_top_nav.html -->
    {% include 'dashboard_nav/customer_top_nav.html' %}
    <div class="container-fluid custom-margin-top">
        <div class="row">
            <!-- insert customer_side_nav.html -->
            {% include 'dashboard_nav/customer_side_nav.html' %}
            <div class="col-xs-12 col-sm-9 ml-sm-auto col-lg-9 px-md-4 py-4 mx-auto mt-5 mb-5">
                <div class="card">
                    <div class="card-header">
                        <h2 class="custom-title">Checkout</h2>
                    </div>
                    <div class="card-body">
                        <form id="payment-form" action="{{ url_for('customer.checkout') }}" method="post" class="needs-validation" novalidate>
                            <div class="mb-3">
                                <label for="card_number" class="form-label">Card number:<span class="require-star">*</span></label>
                                <input type="text" class="form-control" id="card_number" name="card_number" maxlength="19" required>
                                <div class="invalid-feedback text-start">
                                    Please enter the credit card number.
                                </div> 
                            </div>
                            <div class="mb-3">
                                <label for="card_holder" class="form-label">Name on card:<span class="require-star">*</span></label>
                                <input type="text" class="form-control" id="card_holder" name="card_holder" required>
                                <div class="invalid-feedback text-start">
                                    Please enter the credit card holder name.
                                </div> 
                            </div>
                            <div class="mb-3 row justify-content-between">
                                <div class="col-5">
                                    <label for="expiry_m" class="form-label">Expire Date:<span class="require-star">*</span></label>
                                    <div class="d-flex">
                                        <div class="col-8 me-2">
                                            <select id="expiry_m" name="expiry_m" required class="form-select" aria-label="Default select example">
                                                <option disabled selected value>MM</option>
                                            </select>
                                            <div class="invalid-feedback text-start">
                                                Please select expire month.
                                            </div> 
                                        </div>
                                        <div class="col-8">
                                            <select id="expiry_y" name="expiry_y" required class="form-select" aria-label="Default select example">
                                                <option disabled selected value>YY</option>
                                            </select>
                                            <div class="invalid-feedback text-start">
                                                Please select expire year.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-3">
                                    <label for="cvc" class="form-label">CVC:<span class="require-star">*</span></label>
                                    <input type="text" class="form-control" id="cvc" name="cvc" maxlength="3" minlength="3" required>
                                    <div class="invalid-feedback text-start">
                                        Please enter CVC number (3 digits).
                                    </div>
                                </div>
                            </div>
                            <div>
                                <p style="font-size:14px;">We accept Visa, Mastercard and American Express</p>
                            </div>
                            <div class="mb-3">
                                <img src="{{url_for('static',filename='images/visacard-footer.png')}}" alt="visacard" class="card-logo">
                                <img src="{{url_for('static',filename='images/mastercard-footer.png')}}" alt="mastercard" class="card-logo">
                                <img src="{{url_for('static',filename='images/americanexpress-footer.png')}}" alt="americanexpress" class="card-logo">
                            </div>
                            <div class="row mb-3 justify-content-between">
                                <div class="text-center py-3 col-5">
                                    <a href="{{ url_for('customer.cart') }}"><button type="button" class="btn btn-secondary col-12">Cancel</button></a>
                                </div>  
                                <div class="text-center py-3 col-5">
                                    <button type="submit" id="submitPayment" class="btn btn-danger col-12">Submit</button>
                                </div>  
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
(function () {
    'use strict'
    var forms = document.querySelectorAll('.needs-validation')
    Array.prototype.slice.call(forms).forEach(function (form) {
        form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
            }
            form.classList.add('was-validated')
        }, false)
    })
})();
document.addEventListener("DOMContentLoaded", function() {
    const cardNumberInput = document.getElementById('card_number');
    const feedbackElement = cardNumberInput.nextElementSibling;

    cardNumberInput.addEventListener('input', function() {
        const value = cardNumberInput.value.replace(/\D/g, '');
        if (value.length === 16) { 
            cardNumberInput.classList.remove('is-invalid');
            cardNumberInput.classList.add('is-valid');
            feedbackElement.textContent = 'Valid card number';
            feedbackElement.style.color = 'green';
        } else {
            cardNumberInput.classList.remove('is-valid');
            cardNumberInput.classList.add('is-invalid');
            feedbackElement.textContent = 'Invalid card number';
            feedbackElement.style.color = 'red';
        }
    });
});
(function () {
    var today = new Date();
    var currentMonth = today.getMonth() + 2; // Months are zero-based
    var currentYear = today.getFullYear();

    var expiryMonthSelect = document.getElementById('expiry_m');
    var expiryYearSelect = document.getElementById('expiry_y');

    // Populate expiry month options
    for (var month = currentMonth; month <= 12; month++) {
        var option = document.createElement('option');
        option.value = month < 10 ? '0' + month : month;
        option.text = month < 10 ? '0' + month : month;
        expiryMonthSelect.appendChild(option);
    }

    // Populate expiry year options (next 10 years)
    for (var year = currentYear; year <= currentYear + 10; year++) {
        var option = document.createElement('option');
        option.value = year % 100; // Use last two digits
        option.text = year;
        expiryYearSelect.appendChild(option);
    }
})();

</script>
{% endblock %}